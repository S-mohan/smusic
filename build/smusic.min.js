/*!
 * smusic v2.1.0
 * smohan https://smohan.net
 * The MIT License (MIT)
 * https://smohan.net/lab/smusic
 * https://github.com/S-mohan/smusic
 */
function _classCallCheck(s,t){if(!(s instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(s){return typeof s}:function(s){return s&&"function"==typeof Symbol&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s};!function(){"use strict";var s=Array.prototype,t=function(s){return s?s.trim().replace(/\s+/,",").split(","):[]},i=function(s){return s.ownerDocument.defaultView.getComputedStyle(s,null)},e={contains:function(s,t){return s.classList?s.classList.contains(t):new RegExp("(^| )"+t+"( |$)","gi").test(s.className)},add:function(s,i){t(i).forEach(function(t){(t=t.trim())&&!e.contains(s,t)&&(s.classList?s.classList.add(t):(s.className+=" "+t,s.className=s.className.trim()))})},remove:function(s,i){t(i).forEach(function(t){(t=t.trim())&&e.contains(s,t)&&(s.classList?s.classList.remove(t):(s.className=s.className.replace(new RegExp("(^|\\b)"+t.split(" ").join("|")+"(\\b|$)","gi")," "),s.className=s.className.trim()))})},toggle:function(s,i){t(i).forEach(function(t){return s.classList?s.classList.toggle(t):e.contains(s,t)?e.remove(s,t):e.add(s,t)})}},n=function(){var s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s=Object(s);for(var t=1,i=arguments.length;t<i;t++){var e=arguments[t];if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(s[n]=e[n])}return s},a={id:/^#([\w-]+)$/,className:/^\.([\w-]+)$/,tagName:/^[\w-]+$/},l=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"*",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;if("string"==typeof t){t=t.trim();var e=[];return a.id.test(t)?(e=document.getElementById(RegExp.$1),e=e?[e]:[]):e=a.className.test(t)?i.getElementsByClassName(RegExp.$1):a.tagName.test(t)?i.getElementsByTagName(t):i.querySelectorAll(t),s.slice.call(e)}return[]},o=function(){var s=Element.prototype,t=s.matches||s.matchesSelector||s.mozMatchesSelector||s.msMatchesSelector||s.oMatchesSelector||s.webkitMatchesSelector;return function(s,i){return t.call(s,i)}}(),r=function(s,t){if("object"===(void 0===s?"undefined":_typeof(s))&&"function"==typeof t)if(Array.isArray(s))for(var i=0,e=s.length;i<e&&!1!==t.call(s[i],i,s[i]);i++);else if("length"in s&&"number"==typeof s.length)for(var n in s)if(!1===t.call(s[n],n,s[n]))break},c=function(t,i,e,n){var a=void 0,o=void 0;if("function"==typeof e)o=e;else{if("string"!=typeof e||"function"!=typeof n)return;a=e}a&&(o=function(i){for(var e=l(a,t),o=!1,r=0,c=e.length;r<c;r++){var u=e[r];if(u===i.target||u.contains(i.target)){o=u;break}}o&&n.apply(o,s.slice.call(arguments))}),t.addEventListener(i,o,!1)},u=function(s,t,i){return s.removeEventListener(t,i,!1)},m=function(s,t){var i=document.createEvent("HTMLEvents");i.initEvent(t,!0,!1),s.dispatchEvent(i)},d=function(s){var t=[],i=void 0,e=void 0;for(i in s)(e=s[i])&&t.push(i+"="+e.toString());return t.join("&")},p=function(){var s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=s.url||window.location.href,i=s.done||null,e=s.fail||null,n=s.data,a=d(n),l=s.type&&/^(get|post)$/i.test(s.type)?s.type.toUpperCase():"GET",o=new XMLHttpRequest,r=s.headers||{};r.accept="application/json, text/javascript","POST"===l?r["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8":(r["Content-Type"]="application/json; charset=UTF-8",t=t.indexOf("?")>-1?t+a:t,a=void 0),o.open(l,t,!0);for(var c in r)o.setRequestHeader(c,r[c]);o.onload=function(){if(o.status>=200&&o.status<400){var s=o.responseText;try{s=JSON.parse(s)}catch(s){}i&&i.call(null,s,o)}else e&&e.call(o.status,"error",o)},o.send(a)},h={$:function(s,t){return l(s,t)[0]},$$:l,matchSelector:o,addClass:e.add,removeClass:e.remove,hasClass:e.contains,toggleClass:e.toggle,getStyles:i,assign:Object.assign||n,each:r,bind:c,unbind:u,trigger:m,http:p};window.MoUtils=h}(),function(){"use strict";var s=document,t=window,i=MoUtils,e="ontouchend"in document,n="2.1.0",a="https://smohan.net/lab/smusic",l="https://s-mohan.github.io/demo/static/img/smusic.jpg",o=[i.$,i.$$,i.bind,function(){}],r=o[0],c=o[1],u=o[2],m=o[3],d=e?"touchstart":"mousedown",p=e?"touchmove":"mousemove",h=e?"touchend":"mouseup",v=function(e,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"horizontal",l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:m,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:m,c=[e,r(n,e)],v=c[0],f=c[1],y={width:v.offsetWidth,height:v.offsetHeight};u(f,"click",function(s){return s.stopPropagation()}),u(f,d,function(e){e=e||t.event,e.stopPropagation();var n=void 0,r=void 0;n={x:e.clientX||e.touches[0].clientX,y:e.clientY||e.touches[0].clientY},r={x:this.offsetLeft,y:this.offsetTop};var c="horizontal"==a?y.width:y.height,m=function(s){s=s||t.event,s.stopPropagation();var i=s.clientX||s.touches[0].clientX,e=s.clientY||s.touches[0].clientY,o=Math.min(c,Math.max(0,"horizontal"==a?r.x+(i-n.x):r.y+(e-n.y)));l&&"function"==typeof l&&l(o)};u(s,p,m),u(s,h,function(t){o&&"function"==typeof o&&o(),i.unbind(s,p,m)})})},f={container:s.body,playIndex:0,playMode:1,volume:.5,autoPlay:!0,panel:"list"},y=1,g=function(s){throw new Error("Smusic Error："+s)},b=function(s){return t.console.log("Smusic Log："+s)},j=function(s){var t=void 0,i=void 0,e=void 0,n="";return t=String(parseInt(s/3600,10)),i=String(parseInt(s%3600/60,10)),e=String(parseInt(s%60,10)),"0"!=t&&(1==t.length&&(t="0"+t),n+=t+":"),1==i.length&&(i="0"+i),n+=i+":",1==e.length&&(e="0"+e),n+=e},x=function(){var s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"list",t="list"==s;return'\n<main class="smusic-main">\n    <div class="smusic-panel">\n        <div class="smusic-music-info">\n            <div class="smusic-music-scroll js-smusic-scroll--title">\n                <strong class="smusic-music--title js-smusic-song--title">Smusic</strong>\n                <small class="smusic-music--singer js-smusic-song--singer">smohan</small>\n            </div>\n        </div>\n        <figure class="smusic-music-thumbnail">\n            <img src="'+l+'" class="js-smusic-song--thumbnail" alt="'+a+'" />\n        </figure>\n        \x3c!--smusic start: music play ctrl https://smohan.net/lab/smusic --\x3e\n        <div class="smusic-music-ctrl">\n            <a class="smusic-ctrl--prev js-smusic-btn--prev" title="上一首"><i class="smusic-ico-prev"></i></a>\n            <a class="smusic-ctrl--play smusic-music-play js-smusic-btn--play" title="暂停"></a>\n            <a class="smusic-ctrl--next js-smusic-btn--next"><i class="smusic-ico-next" title="下一首"></i></a>\n        </div>\n        \x3c!--smusic end: music ctrl https://smohan.net/lab/smusic --\x3e\n    </div>\n    <div class="smusic-panel">\n        <div class="smusic-panel--scroll js-smusic-scroll--panel '+(t?"show-list":"")+'">\n            <div class="smusic-lyric--wrap">\n                <ul class="smusic-lyric--scroll js-smusic-scroll--lyric"></ul>\n            </div>\n            <div class="smusic-list--wrap">\n                <ul class="smusic-list--scroll js-smusic-scroll--list"></ul>\n            </div>\n        </div>\n    </div>\n</main>\n<aside class="smusic-aside">\n    <div class="smusic-ctrl smusic-ctrl--left">\n        <div class="smusic-ctrl--volume">\n            <a class="smusic-volume--toggle js-smusic-btn--volume"></a>\n            <div class="smusic-volume--bar js-smusic-volume--bar">\n                <span class="smusic-volume--value js-smusic-volume--value"></span>\n                <span class="smusic-volume--slider js-smusic-volume--slider"></span>\n            </div>\n        </div>\n        <a class="smusic-ctrl--mode smusic-mode--loop js-smusic-btn--mode" data-play-mode="1"></a>\n    </div>\n    <div class="smusic-progress js-smusic-progress">\n        <span class="smusic-progress--buffer js-smusic-progress--buffer"></span>\n        <span class="smusic-progress--value js-smusic-progress--value"><i class="smusic-progress--slider js-smusic-progress--slider"></i></span>\n    </div>\n    <div class="smusic-ctrl smusic-ctrl--right">\n        <time class="smusic-time js-smusic-time">00:00/00:00</time>\n        <a class="smusic-ctrl--lyric js-smusic-btn--lyric js-smusic-panel--tab '+(t?"":"active")+'" data-panel="lyric" title="歌词"><i class="smusic-ico-lyric"></i></a>\n        <a class="smusic-ctrl--list js-smusic-btn--list js-smusic-panel--tab '+(t?"active":"")+'" data-panel="list" title="列表"><i class="smusic-ico-list"></i></a>\n    </div>\n</aside>'},C={},M=/\[\d*:\d*((\.|:)\d*)*]/g,w=function(s){var t=s.replace(/(\[\d*:\d*((\.|:)\d*)*])/gm,"\n$1").trim().replace(/\\n/gm,"\n").split("\n"),i={},e=0,n=void 0,a=t.length;for(e;e<a&&"string"==typeof(n=decodeURIComponent(t[e]));e++){var l=n.match(M);if(l)for(var o=0,r=l.length;o<r;o++){var c=l[o],u=Number(String(c.match(/\[\d*/i)).slice(1)),m=Number(String(c.match(/\:\d*/i)).slice(1)),d=60*u+m;i[d]=n.replace(M,"")}}return i},L=function(s,t,e){var n=s[t],a=n.lyric,l="_smusic_lyric_"+t;a||(C[l]=0),C[l]||i.http({type:"GET",url:a,done:function(s){s=s?w(s):-1,C[l]=s,e(C[l])},fail:function(s){C[l]=-2,e(C[l])}}),e(C[l])},S=function(s,t){for(var i=[],e=0;e<t;e++)e!=s&&i.push(e);var n=parseInt(Math.random()*(t-1)),a=i[n];return i=null,a},N=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.container,e=y++,l=s.createElement("div");return l.id="smohan-smusic-"+e,l.className="smusic-container",l.setAttribute("data-smusic-version",n),l.setAttribute("data-smusic-homepage",a),l.setAttribute("data-smusic-id",e.toString()),l.innerHTML=x(t.panel||"list")+'<audio class="js-smusic--audio" hidden></audio>',i.appendChild(l),{element:l,id:e}},I=function(){var s=this.smusic;this.dom={scroll:{title:r(".js-smusic-scroll--title",s),panel:r(".js-smusic-scroll--panel",s),lyric:r(".js-smusic-scroll--lyric",this.panel),list:r(".js-smusic-scroll--list",this.panel)},song:{title:r(".js-smusic-song--title",s),singer:r(".js-smusic-song--singer",s),thumbnail:r(".js-smusic-song--thumbnail",s)},btn:{prev:r(".js-smusic-btn--prev",s),play:r(".js-smusic-btn--play",s),next:r(".js-smusic-btn--next",s),volume:r(".js-smusic-btn--volume",s),mode:r(".js-smusic-btn--mode",s),lyric:r(".js-smusic-btn--lyric",s),list:r(".js-smusic-btn--list",s)},time:r(".js-smusic-time",s),progress:{bar:r(".js-smusic-progress",s),buffer:r(".js-smusic-progress--buffer",this.bar),value:r(".js-smusic-progress--value",this.bar),slider:r(".js-smusic-progress--slider",this.bar)},volume:{bar:r(".js-smusic-volume--bar",s),value:r(".js-smusic-volume--value",this.bar),slider:r(".js-smusic-volume--slider",this.bar)}}},E=function(){var s=this,t=s.dom.scroll.list,i=s.playList,e="";i.forEach(function(t,i){var n=i===s.playIndex?" active":"";e+='<li class="js-smusic-song--item'+n+'" data-song-index="'+i+'">\n<span class="song-animate"><i></i><i></i><i></i></span>\n<span class="song-title" title="'+t.title+'">'+t.title+'</span>\n<span class="song-singer" title="'+t.singer+'">'+t.singer+"</span>\n</li>"}),t.innerHTML=e},T=function(){var s=this,t=s.dom.scroll.lyric.parentNode.offsetHeight,i="",e=0;L(this.playList,this.playIndex,function(n){if("number"==typeof n){switch(n){case 0:i+='<li class="empty">暂无歌词</li>';break;case-1:i+='<li class="empty">歌词解析失败</li>';break;case-2:i+='<li class="empty">歌词加载失败</li>'}s.dom.scroll.lyric.innerHTML=i}else{for(var l in n){var o=30*e,r=o>=t/2-30,c=n[l]||a;"string"!=typeof c&&(c=c.content),n[l]={index:e,content:c,top:o,scrollTop:r?o-(t/2-30):0,toScroll:r},e++,i+="<li>"+c+"</li>"}s.dom.scroll.lyric.innerHTML=i+'<li><a href="'+a+'" title="Smusic" target="_blank">'+a+"</a></li>"}})},k={},A=function(){var s=[this.dom,this.audio,this.smusicId],t=s[0],i=s[1],e=s[2];k[e]&&clearInterval(k[e]);var n=parseFloat(t.progress.bar.offsetWidth);if(!isNaN(i.duration)){var a=j(i.duration);t.time.textContent="00:00/"+a}k[e]=setInterval(function(){var s=i.buffered.length;if(s>0&&void 0!=i.buffered){var a=i.buffered.end(s-1)/i.duration*n;t.progress.buffer.style.width=a+"px",Math.abs(i.duration-i.buffered.end(s-1))<1&&(t.progress.buffer.style.width=n+"px",clearInterval(k[e]))}},1e3)},$=function(){var s=[this,this.dom,this.audio],t=s[0],e=s[1],n=s[2],a=Math.round(e.progress.bar.offsetWidth),l=Math.round(e.volume.bar.offsetHeight);u(t.smusic,"click",".js-smusic-panel--tab",function(s){if(s.stopPropagation(),i.hasClass(this,"active"))return!1;var t=this.getAttribute("data-panel");i.addClass(this,"active"),"list"===t?(i.removeClass(e.btn.lyric,"active"),i.addClass(e.scroll.panel,"show-list")):(i.removeClass(e.btn.list,"active"),i.removeClass(e.scroll.panel,"show-list"))}),u(n,"timeupdate",function(){if(!isNaN(n.duration)){var s=j(n.currentTime),l=j(n.duration),o=n.currentTime/n.duration*a;e.time.textContent=s+"/"+l;var r=Math.min(o,a);e.progress.value.style.width=r+"px";var u="_smusic_lyric_"+t.playIndex,m=C[u];if(!m)return;var d=Math.round(n.currentTime),p=m[d];if(!p||"number"==typeof p)return;var h=p.index,v=p.toScroll,f=c("li",e.scroll.lyric)[h];c("li.active",e.scroll.lyric).forEach(function(s){s&&i.removeClass(s,"active")}),f&&i.addClass(f,"active"),e.scroll.lyric.style.transform=v?"translate3d(0, -"+p.scrollTop+"px, 0)":"translate3d(0, 0, 0)"}}),u(e.btn.mode,"click",function(){var s=this.getAttribute("data-play-mode"),i=void 0;switch(Number(s)){case 1:i=2;break;case 2:i=3;break;case 3:i=1}t.setMode(i)}),u(e.btn.play,"click",function(){i.hasClass(this,"smusic-music-play")?t.pause():t.play()}),u(n,"ended",function(){return t.playByMode("ended")}),u(e.btn.prev,"click",function(){return t.prev()}),u(e.btn.next,"click",function(){return t.next()}),v(e.progress.bar,".js-smusic-progress--slider","horizontal",function(s){var t=Math.max(0,Math.min(s/a,a));n.currentTime&&n.duration&&(n.currentTime=Math.round(t*n.duration))}),u(e.progress.bar,"click",function(s){s.stopPropagation();var i=this.getBoundingClientRect(),e=Math.min(a,Math.abs(s.clientX-i.left))/a;n.currentTime&&n.duration&&(n.currentTime=Math.round(e*n.duration),t.play())}),v(e.volume.bar,".js-smusic-volume--slider","vertical",function(s){var i=Number((l-s)/l);t.setVolume(i)}),u(e.btn.volume,"click",function(s){n.muted?(i.removeClass(this,"smusic-volume--mute"),this.setAttribute("title","静音"),n.muted=!1):(i.addClass(this,"smusic-volume--mute"),this.setAttribute("title","取消静音"),n.muted=!0)}),u(e.scroll.list,"click",".js-smusic-song--item",function(s){var e=this.getAttribute("data-song-index");i.hasClass(this,"active")?t.play():H.call(t,e)})},H=function(s,t,e){var n=[this.dom,this.audio,this.playList.length],a=n[0],o=n[1],r=n[2];s>=r-1&&(s=r-1),s<=0&&(s=0),this.playIndex=s;var u=this.playList[this.playIndex];if(!u)return b("没有要播放的歌曲"),!1;var m=function(){return A.call(this)}.bind(this);o.removeEventListener("canplay",m,!1),k[this.smusicId]&&clearInterval(k[this.smusicId]),a.progress.buffer.style.width="0px",a.progress.value.style.width="0px",a.time.textContent="00:00/00:00",a.scroll.lyric.style.transform="translate3d(0, 0, 0)",a.scroll.lyric.innerHTML='<li class="empty">正在加载歌词...</li>',c(".js-smusic-song--item.active",a.scroll.list).forEach(function(s){s&&i.removeClass(s,"active, pause")});var d=c(".js-smusic-song--item",a.scroll.list)[s];d&&i.addClass(d,"active"),o.src=u.audio,o.load(),o.addEventListener("canplay",m,!1),e?this.config.autoPlay&&o.play():o.play();var p=u.title||"Smusic",h=u.singer||"singer",v=u.thumbnail||l;a.song.title.textContent=p,a.song.singer.textContent=h,a.song.thumbnail.src=v,a.scroll.title.setAttribute("title",h+" - "+p),T.call(this),t&&t.call(this,u)},_=function(){function s(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,s),Array.isArray(t)||g("播放列表必须是一个数组"),this.playList=t,this.audio=null,this.version=n,this.config=i.assign({},f,e);var a=parseInt(this.config.playIndex),l=parseInt(this.config.playMode),o=parseFloat(this.config.volume);a<0&&(a=0),a>this.playList.length-1&&(a=this.playList.length-1),(l<1||l>3)&&(l=1),(o<0||o>1)&&(o=.5),this.playIndex=a,this.playMode=l,this.volume=o}return s.prototype.playByMode=function(s,t,i){var e=[Number(this.playMode),this.playIndex,this.playList.length],n=e[0],a=e[1],l=e[2],o=a;if(s||2==n)switch(n){case 1:"prev"==s?o=a<=l-1&&a>0?a-1:l-1:"next"!=s&&"ended"!=s||(o=a>=l-1?0:a+1);break;case 2:o=S(a,l);break;case 3:o="prev"==s?a<=l-1&&a>0?a-1:l-1:"next"==s?a>=l-1?0:a+1:a}else;H.call(this,o,t,i)},s.prototype.addSong=function(){var s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m;return s&&s.audio?(this.playList.push({title:s.title||"歌曲名",singer:s.singer||"歌手名",audio:s.audio,thumbnail:s.thumbnail||l,lyric:""|s.lyric}),this.refreshList(),t&&t()):t&&t("添加失败，参数不是一个对象或者未设置audio属性"),this.playList},s.prototype.refreshList=function(){E.call(this)},s.prototype.next=function(s){this.playByMode("next",s)},s.prototype.prev=function(s){this.playByMode("next",s)},s.prototype.play=function(s){var t=this.dom.btn.play;i.removeClass(t,"smusic-music-pause"),i.addClass(t,"smusic-music-play"),t.setAttribute("title","暂停");var e=r(".js-smusic-song--item.active",this.dom.scroll.list);i.removeClass(e,"pause"),this.playList.length&&this.audio.play(),s&&s.call(this,this.playList[this.playIndex])},s.prototype.pause=function(s){var t=this.dom.btn.play;i.addClass(t,"smusic-music-pause"),i.removeClass(t,"smusic-music-play");var e=r(".js-smusic-song--item.active",this.dom.scroll.list);i.addClass(e,"pause"),t.setAttribute("title","播放"),this.playList.length&&this.audio.pause(),s&&s.call(this,this.playList[this.playIndex])},s.prototype.setVolume=function(){var s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5;s=Number(s),s<0&&(s=0),s>1&&(s=1);var t=this.dom.volume.bar.offsetHeight,e=this.dom.volume.slider.offsetHeight,n=t*s,a=Math.min((1-s)*t,t-e);0===s?(i.addClass(this.dom.btn.volume,"smusic-volume--mute"),this.dom.btn.volume.setAttribute("title","取消静音"),this.audio.muted=!0):(i.removeClass(this.dom.btn.volume,"smusic-volume--mute"),this.audio.muted=!1,this.dom.btn.volume.setAttribute("title","静音")),this.dom.volume.value.style.height=n+"px",this.dom.volume.slider.style.top=a+"px",this.volume=s,this.audio.volume=s},s.prototype.setMode=function(){var s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;s=Number(s);var t=void 0,i=void 0,e=this.dom.btn.mode;switch(s){case 1:default:t="列表循环",i="smusic-mode--loop";break;case 2:t="随机播放",i="smusic-mode--random";break;case 3:t="单曲循环",i="smusic-mode--single"}e.setAttribute("data-play-mode",s.toString()),e.setAttribute("title",t),e.className=e.className.replace(/smusic-mode--\w+/,i),this.playMode=s},s.prototype.init=function(){var s=[this.config,N(this.config)],t=s[0],e=s[1];this.smusic=e.element,this.smusicId=e.id,this.audio=this.smusic.getElementsByTagName("audio")[0],I.call(this),E.call(this),$.call(this),this.setVolume(this.volume),this.setMode(this.playMode),this.playList.length?this.playByMode(void 0,function(){t.autoPlay||i.trigger(this.dom.btn.play,"click")},!0):b("歌曲列表为空")},s.prototype.getCurrentInfo=function(){if(this.playList.length){var s=this.playList[this.playIndex];return s.index=this.playIndex,s.volume=this.volume,s.mode=this.playMode,s}return null},s.prototype.destroy=function(){},s}();t.SMusic=function(s,t){return new _(s,t)}}();